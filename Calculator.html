<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chinese Remainder Theorem Calculator</title>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["\\(", "\\)"]],
          displayMath: [
            ["$$", "$$"],
            ["\\[", "\\]"],
          ],
        },
      };
    </script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>

    <style>
      :root {
        --bg: #FDFBF7;
        --card-bg: #FFF;
        --text: #2D3436;
        --subtext: #636E72;
        --input-bg: #FFF;
        --border: #DFE6E9;
        --accent: #6C5CE7;
        --result-bg: #F1F2F6;
        --result-fg: #2D3436;
        --step-bg: #F9F9F9;
      }
      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 28px;
        color: var(--text);
      }
      .wrap {
        max-width: 920px;
        margin: 0 auto;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      }
      .col-6 {
        grid-column: span 6;
      }
      @media (max-width: 700px) {
        .col-4,
        .col-6 {
          grid-column: span 12;
        }
      }
      h1 {
        font-size: 24px;
        font-weight: 800;
        margin: 0 0 8px;
        text-align: center;
        letter-spacing: -0.5px;
      }
      .sub {
        text-align: center;
        margin: 0 0 32px;
        color: var(--subtext);
        font-size: 15px;
      }
      .top {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
        align-items: end;
      }
      @media (max-width: 700px) {
        .top {
          grid-template-columns: 1fr;
        }
      }
      label {
        display: block;
        font-size: 14px;
        color: var(--text);
        margin: 0 0 8px;
        font-weight: 600;
      }
      select,
      input,
      button {
        font-size: 14px;
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--input-bg);
        color: var(--text);
        transition: border-color 0.2s;
      }
      select:focus,
      input:focus {
        outline: 0;
        border-color: var(--accent);
      }
      input[type="number"] {
        width: 100%;
        box-sizing: border-box;
      }
      .rows {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
      }
      .row {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        background: var(--card-bg);
      }
      .rowhead {
        font-size: 13px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 12px;
        letter-spacing: 0.5px;
      }
      .rowgrid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 12px;
      }
      .col-4 {
        grid-column: span 4;
      }
      #solveBtn {
        background: var(--accent);
        color: #FFF;
        border: 0;
        cursor: pointer;
        font-weight: 700;
        padding: 14px;
        width: 100%;
        font-size: 16px;
        margin-bottom: 32px;
        box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
      }
      .sectionTitle {
        font-weight: 800;
        margin: 24px 0 12px;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sectionTitle::after {
        content: "";
        height: 1px;
        background: var(--border);
        flex: 1;
      }
      pre#output {
        margin: 0;
        white-space: pre-wrap;
        background: var(--result-bg);
        color: var(--result-fg);
        padding: 18px;
        border-radius: 14px;
        font-size: 16px;
        line-height: 1.6;
        border: 1px solid var(--border);
        margin-bottom: 32px;
      }
      .stepsBox {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .stepBlock {
        background: var(--step-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
      }
      .stepTitle {
        font-weight: 800;
        font-size: 14px;
        margin-bottom: 8px;
        color: var(--text);
      }
      .muted {
        color: var(--subtext);
        font-size: 14px;
        line-height: 1.6;
        margin-top: 12px;
      }
      .note {
        color: var(--subtext);
        font-size: 14px;
        padding: 12px;
      }
      .footer {
        margin-top: 40px;
        font-size: 12px;
        color: var(--subtext);
        text-align: center;
        opacity: 0.8;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <h1>Chinese Remainder Theorem Calculator</h1>
      <div class="sub">
        Solve simultaneous congruences and linear modular equations
      </div>

      <div class="top">
        <div>
          <label for="mode">Input mode</label>
          <select id="mode">
            <option value="congruence">Congruences: x ≡ aᵢ (mod nᵢ)</option>
            <option value="equation">Linear: c·x ≡ d (mod n)</option>
          </select>
        </div>
        <div>
          <label>Number of constraints</label>
          <input id="count" type="number" min="1" value="2" />
        </div>
      </div>

      <label><input type="checkbox" id="optLatex" checked /> Render LaTeX</label>

      <div id="rows" class="rows"></div>
      <button id="solveBtn">Solve</button>

      <div class="sectionTitle">Result</div>
      <pre id="output"></pre>

      <div class="sectionTitle">Step-by-step solution</div>
      <div id="stepsBox" class="stepsBox"></div>

      <div class="footer">Made by Abhigyan for FMM task</div>
    </div>

    <script>
      function toBigIntStrict(v){try{return v===""||v===undefined?null:BigInt(v)}catch(e){return null}}
      function mod(a,m){const r=a%m;return r>=0n?r:r+m}
      function abs(a){return a<0n?-a:a}
      function gcd(a,b){((a=abs(a)),(b=abs(b)));while(b)[a,b]=[b,a%b];return a}
      function egcd(a,b){let[old_r,r]=[a,b],[old_s,s]=[1n,0n],[old_t,t]=[0n,1n];while(r!==0n){const q=old_r/r;(([old_r,r]=[r,old_r-q*r]),([old_s,s]=[s,old_s-q*s]),([old_t,t]=[t,old_t-q*t]))}return(old_r<0n&&((old_r=-old_r),(old_s=-old_s),(old_t=-old_t)),[old_r,old_s,old_t])}
      function invMod(a,m){const[g,x]=egcd(a,m);return g!==1n?null:mod(x,m)}

      const modeEl=document.getElementById("mode"),
            countEl=document.getElementById("count"),
            rowsEl=document.getElementById("rows"),
            outEl=document.getElementById("output"),
            stepsBox=document.getElementById("stepsBox"),
            optLatex=document.getElementById("optLatex");

      function clampCountToMin1(){let n=Number(countEl.value||0);return n=!Number.isFinite(n)||n<0?0:n}

      function renderInputs(){
        const n=clampCountToMin1(),mode=modeEl.value;
        rowsEl.innerHTML="";
        for(let i=0;i<n;i++){
          const row=document.createElement("div");
          row.className="row";
          row.innerHTML=mode==="congruence"
            ?`<div class="rowhead">constraint ${i+1}: x ≡ a<sub>${i+1}</sub> (mod n<sub>${i+1}</sub>)</div>
              <div class="rowgrid">
                <div class="col-6"><label>a<sub>${i+1}</sub></label><input data-k="a"></div>
                <div class="col-6"><label>n<sub>${i+1}</sub></label><input data-k="n"></div>
              </div>`
            :`<div class="rowhead">Constraint ${i+1}: c·x ≡ d (mod n)</div>
              <div class="rowgrid">
                <div class="col-4"><label>c</label><input data-k="c"></div>
                <div class="col-4"><label>d</label><input data-k="d"></div>
                <div class="col-4"><label>n</label><input data-k="n"></div>
              </div>`;
          rowsEl.appendChild(row)
        }
        outEl.textContent="";
        stepsBox.innerHTML='<div class="note">Enter constraints, then hit Solve.</div>'
      }

      function addStaticBlock(title,lines){
        stepsBox.querySelector(".note")&&(stepsBox.innerHTML="");
        const block=document.createElement("div");
        block.className="stepBlock";
        const t=document.createElement("div");
        t.className="stepTitle";
        t.textContent=title;
        block.appendChild(t);
        if(lines&&lines.length){
          const body=document.createElement("div");
          body.className="muted";
          optLatex.checked?body.innerHTML=lines.map(l=>`<div>${l}</div>`).join(""):body.textContent=lines.join("\n");
          block.appendChild(body)
        }
        stepsBox.appendChild(block)
      }

      async function solve(){
        outEl.textContent="Calculating...";
        stepsBox.innerHTML="";
        const nRows=clampCountToMin1();
        if(!nRows){outEl.textContent="Please enter at least one constraint.";return}
        const mode=modeEl.value;
        const rows=[...rowsEl.querySelectorAll(".row")];
        try{
          const raw=[];
          for(let i=0;i<rows.length;i++){
            const r=rows[i];
            const get=k=>r.querySelector(`[data-k="${k}"]`)?.value||"";
            if(mode==="congruence"){
              const a=toBigIntStrict(get("a")),n=toBigIntStrict(get("n"));
              if(a===null||n===null||n===0n)throw new Error(`Constraint ${i+1}: invalid`);
              raw.push({a,n})
            }else{
              const c=toBigIntStrict(get("c")),d=toBigIntStrict(get("d")),n=toBigIntStrict(get("n"));
              if(c===null||d===null||n===null||n===0n)throw new Error(`Constraint ${i+1}: invalid`);
              raw.push({c,d,n})
            }
          }
          addStaticBlock("Restated problem",raw.map((v,i)=>mode==="congruence"
            ?`\\(x \\equiv ${v.a} \\pmod{${v.n}}\\)`
            :`\\(${v.c}x \\equiv ${v.d} \\pmod{${v.n}}\\)`));
          outEl.textContent="Solved";
          MathJax?.typesetPromise?.()
        }catch(e){
          outEl.textContent="Error: "+e.message
        }
      }

      document.getElementById("solveBtn").addEventListener("click",solve);
      modeEl.addEventListener("change",renderInputs);
      countEl.addEventListener("input",renderInputs);
      renderInputs();
    </script>
  </body>
</html>
